<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./files/main.css">
</head>
<body>
    <div id = topbar>
        <div id = "nodes">
            <button onclick="selectAll()" class="node selected bulk">Alle</button>
            <!--[insert nodes here]-->
        </div>
        <button onclick = "window.location = './settings'" id="settings"><svg xmlns="http://www.w3.org/2000/svg" viewBox="-5.6 -4.1 11.2 8.2">
	<path d="M -5 3 L 5 3 Q 6 3.5 5 4 L -5 4 Q -6 3.5 -5 3 M -5 -0.5 L 5 -0.5 Q 6 0 5 0.5 L -5 0.5 Q -6 0 -5 -0.5 M -5 -4 L 5 -4 Q 6 -3.5 5 -3 L -5 -3 Q -6 -3.5 -5 -4" stroke="#000000" stroke-width="0" fill="#FFFFFF"/></svg></button>
    </div>
    <div id = "scroll">
        <div id = "grid">
            <!--[insert grid here]-->
        </div>
    </div>
</body>
<script src = "./files/gridItemHtml.js"></script>
<script>
    function updateGrid(){
        const selectedNodes = [...document.querySelectorAll(".node:not(.selected):not(.bulk)")].map(node=>node.innerText);
        console.log(selectedNodes);
        let str = "/items";
        if(selectedNodes.length > 0){
            str += "?";
            str += selectedNodes.map(node=>`${node}=false`).join("&");
        }
        let html = ""
        fetch(str).then(res=>res.json()).then(json=>{
            json.forEach(item=>{
                html += gridItemHTML(item.name,item.stock,item.expected,item.min,item.img); //defined in ./files/gridItemHtml.js
            })
            grid.innerHTML = html;
        });
    }
    function selectAll(){
        document.querySelectorAll(".node").forEach(node => node.classList.add("selected"));
        updateGrid();
    }
    function toggleSelect(node){
        if(node.classList.contains("selected")){
            document.querySelector(".node.bulk").classList.remove("selected");
        }
        node.classList.toggle("selected");
        let nodes = [...document.querySelectorAll(".node.selected:not(.bulk)")];
        let allNodes = [...document.querySelectorAll(".node:not(.bulk)")];
        if(nodes.length >= allNodes.length){
            document.querySelector(".node.bulk").classList.add("selected");
        }
        updateGrid();
    }


</script>
</html>